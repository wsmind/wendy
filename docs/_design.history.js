{"_id":"_design/history","_rev":"21-565dd90de6bce2ead5e64e8817df2997","language":"javascript","views":{"asset":{"map":"function(doc) {\n\tfor (var path in doc.assets)\n\t{\n\t\tvar asset = doc.assets[path]\n\t\t\n\t\tvar revision = {\n\t\t\thash: asset.hash,\n\t\t\tsize: asset.size,\n\t\t\tauthor: doc.author,\n\t\t\tdescription: doc.description\n\t\t}\n\t\t\n\t\tvar history = {}\n\t\thistory[doc._id] = revision\n\t\temit(path, history);\n\t}\n}","reduce":"function(key, values, rereduce)\n{\n\tvar history = values[0]\n\tfor (var i = 1; i < values.length; i++)\n\t{\n\t\tvar otherHistory = values[i]\n\t\tfor (var version in otherHistory)\n\t\t{\n\t\t\thistory[version] = otherHistory[version]\n\t\t}\n\t}\n\treturn history\n}"},"folder":{"map":"function(doc) {\n\tfor (var path in doc.assets)\n\t{\n\t\tvar asset = doc.assets[path]\n\t\tvar history = {}\n\t\thistory[doc._id] = {\n\t\t\tsize: asset.size ? asset.size : 0,\n\t\t\tauthor: doc.author,\n\t\t\tdescription: doc.description\n\t\t}\n\t\tvar folder = \"\"\n\t\tvar slashPos = path.lastIndexOf(\"/\")\n\t\tif (slashPos > 0)\n\t\t\tfolder = path.slice(0, slashPos)\n\t\temit(folder, history);\n\t}\n}","reduce":"function(key, values, rereduce)\n{\n\tvar history = values[0]\n\tfor (var i = 1; i < values.length; i++)\n\t{\n\t\tvar otherHistory = values[i]\n\t\tfor (var version in otherHistory)\n\t\t{\n\t\t\tif (!history[version])\n\t\t\t{\n\t\t\t\thistory[version] = otherHistory[version]\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\thistory[version].size += otherHistory[version].size\n\t\t\t}\n\t\t}\n\t}\n\treturn history\n}\n"},"latest":{"map":"function(doc) {\n\tfor (var path in doc.assets)\n\t{\n\t\tvar asset = doc.assets[path]\n\t\t\n\t\tvar history = {}\n\t\thistory[doc._id] = {hash: asset.hash}\n\t\temit(path, history);\n\t}\n}","reduce":"function(key, values, rereduce)\n{\n\tvar mostRecent = Object.keys(values[0])[0]\n\tvar index = 0\n\tfor (var i = 1; i < values.length; i++)\n\t{\n\t\tvar time = Object.keys(values[i])[0]\n\t\tif (time > mostRecent)\n\t\t{\n\t\t\tmostRecent = time\n\t\t\tindex = i\n\t\t}\n\t}\n\treturn values[index]\n}"},"latest2":{"map":"function(doc) {\n\tfor (var path in doc.assets)\n\t{\n\t\tvar asset = doc.assets[path]\n\t\t\n\t\tvar revision = {\n\t\t\thash: asset.hash,\n\t\t\tsize: asset.size,\n\t\t\tauthor: doc.author,\n\t\t\tdescription: doc.description\n\t\t}\n\t\t\n\t\tvar history = {}\n\t\thistory[doc._id] = revision\n\t\temit(path, history);\n\t}\n}","reduce":"function(key, values, rereduce)\n{\n\tvar mostRecent = Object.keys(values[0])[0]\n\tvar index = 0\n\tfor (var i = 1; i < values.length; i++)\n\t{\n\t\tvar time = Object.keys(values[i])[0]\n\t\tif (time > mostRecent)\n\t\t{\n\t\t\tmostRecent = time\n\t\t\tindex = i\n\t\t}\n\t}\n\treturn values[index]\n}"},"by_asset":{"map":"function(doc) {\n\tfor (var path in doc.assets)\n\t{\n\t\temit(path.substr(1).split(\"/\"), doc);\n\t}\n}"}}}
